version: "3.8"
services:
  charger:
    depends_on:
      - storage
      - messaging
    build: ./charger
    ports:
      - "3001:3001"
    environment:
      - "REDIS_URL=redis://storage:6379/15"
      - "RABBITMQ_URL=amqp://messaging:5672"
      - "REDIS_PROVIDER=REDIS_URL"
  fetcher:
    depends_on:
      - storage
      - messaging
    build: ./charger
    entrypoint: ["bundle", "exec", "sidekiq"]
    environment:
      - "REDIS_URL=redis://storage:6379/15"
      - "RABBITMQ_URL=amqp://messaging:5672"
      - "REDIS_PROVIDER=REDIS_URL"
      - "FETCHER_TWT_API_KEY=${FETCHER_TWT_API_KEY}"
      - "FETCHER_TWT_API_SECRET=${FETCHER_TWT_API_SECRET}"
      - "FETCHER_TWT_ACCESS_TOKEN=${FETCHER_TWT_ACCESS_TOKEN}"
      - "FETCHER_TWT_ACCESS_TOKEN_SECRET=${FETCHER_TWT_ACCESS_TOKEN_SECRET}"
    laser:
      depends_on:
        - storage
      build: ./blaster
      ports:
        - "3002:3002"
      environment:
        - "REDIS_URL=redis://storage:6379/15"
        - "RABBITMQ_URL=amqp://messaging:5672"
        - "REDIS_PROVIDER=REDIS_URL"
    blaster:
      depends_on:
        - storage
        - messaging
      build: ./blaster
      # entrypoint: ["bundle", "exec", "sidekiq"]
      ports:
        - "3002:3002"
      environment:
        - "REDIS_URL=redis://storage:6379/15"
        - "RABBITMQ_URL=amqp://messaging:5672"
        - "REDIS_PROVIDER=REDIS_URL"
  storage:
    image: redis:6.0.3-alpine3.11
    ports:
      - "6400:6379"
  messaging:
    image: rabbitmq:3.8.4-alpine
    ports:
      - "5600:5672"
